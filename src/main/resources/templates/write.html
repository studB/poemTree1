<!DOCTYPE HTML>
<html xml:lang xmlns:th="http://www.thymeleaf.org">
  <head>
<style>
body{
  display: flex;
  flex-direction: column;
  height: 99%;
}
div{
  border: 1px solid red;
}
.upPannel{
 flex: 1;
}

.downPannel{
  flex: 3;
  display: flex;
}

#poemlist{
  width: 200px;
  overflow-y: auto;
}

#contentBox{
  flex: 1;
}

.titleBox{
  height: 50px;
}

.poemBox{
  height: 100% - 50px;
  overflow: auto;
}
</style>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <div class="upPannel">
      <button onclick="location.href = 'page?num=0'">List</button>
        <button onclick="logout()">Logout</button>
        <span>Hello, Enjoy your writing</span>
      </div>
      <div class="downPannel">
        <div id="poemlist">
          <div>
            <button id="createbutton" onclick="writePoem()">Create</button>
          </div>
          <div id="poems"></div>
        </div>
        <div id="contentBox">
        </div>
      </div>
  </body>
  <script>

    var logout = function(){
      axios.request({
        method : 'GET',
        url : 'http://localhost:8080/logout'
      }).then(location.href = "/")
      .error(err => console.log(error))
    }

    var writePoem = function(){
      var innerH = "<form action='create' method='POST'><div class='titlebox'><input type='text' name='title' required/></div><div class='poembox'><textarea name='poem'></textarea></div><button type='submit'>update</button></form>";
      var contentBox = document.getElementById("contentBox");
      var newbox = document.createElement("div");
      newbox.innerHTML = innerH;
      contentBox.appendChild(newbox);
      
      var createbutton = document.getElementById("createbutton");
      createbutton.style.visibility = "hidden";
    }

    var getId = function(event){
      var tag;
      if (!e) {
          var e = window.event;
      }
      if (e.target) {
          tag=e.target;
      } else if (e.srcElement) {
          tag=e.srcElement;
      }
      var tid;
      tid = tag.id;

      axios.request({
        method : 'GET',
        url : "http://localhost:8080/loadPoem?pnum=" + tid 
      }).then(response => {
        var d = response.data;
        var innerV = "<div>" + d.title + "</div><div>" + d.poem + "</div>";
        var create = document.createElement("div");
        create.innerHTML = innerV;

        var contentBox = document.getElementById("contentBox");
        
        contentBox.appendChild(create);
      })
      .catch(error => console.log(error))
    }


    var listing = function(){
  
      axios.request({
        method : 'GET',
        url : "http://localhost:8080/mylist"
      })
      .then(response => {
        console.log(response.data)
        for( index in response.data){
            var pnum = response.data[index].pnum;
            var title = response.data[index].title;
            var box = document.createElement("div");
            box.setAttribute("id", pnum);
            box.setAttribute("onclick", "getId(event)");
            box.innerText = title;

            var poems = document.getElementById("poems");
            poems.appendChild(box);
        }
      })
      .catch(error => {console.log(error)})
  
    }
  
    listing();
  </script>
</html>